{% if mysql_ha == 'master-slave' or groups[bra ~ '-mysql'].index(inventory_hostname) + 1 == 2 %}
{% set host = MYSQL.SERVERS[0].HOST %}
{% elif mysql_ha == 'master-master-slave' and groups[bra ~ '-mysql'].index(inventory_hostname) + 1 >= 3 %}
{% set host = MYSQL.SERVERS[1].HOST %}
{% else %}
{% set host = MYSQL.SERVERS[0].HOST %}
{% endif %}

STOP SLAVE;
{% if groups[bra ~ '-mysql'].index(inventory_hostname) + 1 >= 2 and (mysql_version == '5.5' or mysql_version == '5.6') or MYSQL.GTID_MODE == 'no' or MYSQL.GTID_MODE == 0 or MYSQL.GTID_MODE == false %}
CHANGE MASTER TO MASTER_HOST='{{ host }}', 
                 MASTER_USER='replicator', 
                 MASTER_PASSWORD='mysql_pass_replicator', 
                 MASTER_LOG_FILE='mysql-bin.000001', 
                 MASTER_LOG_POS=2760,
                 MASTER_CONNECT_RETRY=30;
{% else %}               
CHANGE MASTER TO MASTER_HOST='{{ host }}', 
                 MASTER_USER='replicator', 
                 MASTER_PASSWORD='mysql_pass_replicator', 
                 MASTER_AUTO_POSITION=1,
                 MASTER_CONNECT_RETRY=30;
{% endif %}
START SLAVE;
SHOW SLAVE STATUS;
