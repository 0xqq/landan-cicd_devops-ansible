---
- name: yum insatll epel.rpm
  yum: 
    name: https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm
- name: yum insatll remi.rpm
  yum: 
    name: http://rpms.remirepo.net/enterprise/remi-release-7.rpm
  notify: debug yum install 
- name: yum install yum-utils
  yum:
    name: yum-utils
    state: present
- name: 'command yum-config-manager --disable remi-php'
  command: "yum-config-manager --disable {{ item }}"
  with_items:
    - remi-php54
    - remi-php55
    - remi-php56
    - remi-php70
    - remi-php71
    - remi-php72
    - remi-php73
  loop_control:
    label: "yum-config-manager --disable {{ item }}"

- name: "(command) yum-config-manager --enable remi-php"
  command: "yum-config-manager --enable {{ item }}"
  with_items:
    - "remi-php{{ php_version | default(5.6) | regex_replace('([0-9]+).([0-9]+)', '\\1\\2') }}"

- name: (yum) yum remove php...
  yum: 
    name: php*
    state: absent

- name: (yum) yum install php...
  yum: 
    name:
      - php
      # - php-memcached
      - php-pdo
      - php-pdo_mysql
      - php-mcrypt 
      - php-cli 
      - php-gd 
      # - php-curl 
      - php-mysql 
      - php-ldap 
      # - php-zip 
      # - php-fileinfo
      - php-fpm
      - php-common 
      - php-devel 
      # - php-pecl-json # php 5.6 没有
      - php-mbstring 
      # - php-mysqlnd 
      - php-xml 
      - php-xmlrpc 
      # - php-opcache # php 5.6 没有
      - php-pecl-xdebug # php 7.0 开始 可以 php-xdebug ， php 5.6 不可用 php-xdebug
      - php-swoole
    state: latest
  notify: debug yum install php